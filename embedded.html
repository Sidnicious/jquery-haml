<!-- ex:ts=2:et: -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang='en' xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>jQuery HAML + UI Example Page</title>
    <script type="text/javascript" src="jquery/jquery-1.3.2.min.js"></script>
    <style type="text/css">body{font-size: 11px;}</style>
    <link type="text/css" href="css/sunny/jquery-ui-1.7.2.custom.css" rel="stylesheet" />
    <script type="text/javascript" src="jquery/jquery-ui-1.7.2.custom.min.js"></script>
    <script type="text/javascript" src="js/showdown.js"></script>
    <script type="text/javascript" src="js/jquery.haml-1.3.js"></script>
    <script type="text/javascript">
      $(function () {

        // Pulls data from script tags and optionally parses it based on mime type
        var data_store = {};
        var converter;
        function load_data(id) {
          if (!data_store[id]) {
            $("script#" + id).each(function () {
            
              // Pull the contents out of the script tag
              var lines = $(this).html().split("\n");
              lines.shift();
              // We don't care about empty script tags.
              if (lines.length === 0) {
                return;
              }
              // Remove indentation so that the first line starts flush
              var indent = lines[0].match(/^[ \t]*/)[0].length;
              var data = $.map(lines, function (line) {
                return line.substr(indent);
              }).join("\n");
              
              // If the mime type is a known transformer, then transform it automatically
              switch (this.type) {
              // Process haml through haml-js
              case "text/x-haml":
                data = $.haml_parse(data);
                break;
              // Process markdown through Showdown
              case "text/x-markdown":
                if (!converter) {
                  converter = new Showdown.converter();
                }
                data = converter.makeHtml(data);
                break;
              }
              data_store[this.id] = {type: this.type, data: data};
            });
          }
          return data_store[id];
        }
        
        // Replace the script tags with their rendered contents
        $('body script').each(function () {
          if (this.type !== "text/javascript") {
            var contents = load_data(this.id);
            switch(contents.type) {
            case "text/x-haml":
              var new_node = document.createElement('div');
              $(this).haml(contents.data, "replaceWith");
              break;
            case "text/x-markdown":
              $(this).replaceWith(contents.data);
              break;
            }
          }
        
        });

        $('body').haml(load_data('datepicker'));
        $('body').append(load_data('welcome_text'));
        $('body').haml(load_data('accordian'));
      
      });
    </script>
  </head>
  <body>
    <table><tr><td valign="top">
    <script id="welcome_text" type="text/x-markdown">
      WMD Demo
      ========

      *Modify or delete this text in the editor above.*

      WMD's context-sensitive commands pack a lot of power into a simple user interface.  Here are some advanced features to try:


      Keyboard shortcuts
      ------------------

      Use keyboard shortcuts to quickly toggle formatting while you type:

        - Ctrl+B for **strong**
        - Ctrl+I for *emphasis*
        - Ctrl+K for `code`

      See the tooltips for other keyboard commands.
    </script>
    </td><td valign="top" style="width:33%">
    <script id="datepicker" type="text/x-haml">
      %div{$: {datepicker: []}}
    </script>
    </td><td valign="top" style="width:33%">
    <script id="accordian" type="text/x-haml">
      %div{$: {accordion: []}}
        %h3
          %a{ href: "#" }
            Section 1
        %div
          %p
            Mauris mauris ante, blandit et, ultrices a, suscipit eget, quam. Integer
            ut neque. Vivamus nisi metus, molestie vel, gravida in, condimentum sit
            amet, nunc. Nam a nibh. Donec suscipit eros. Nam mi. Proin viverra leo ut
            odio. Curabitur malesuada. Vestibulum a velit eu ante scelerisque vulputate.
        %h3
          %a{ href: "#" }
            Section 2
        %div
          %p
            Sed non urna. Donec et ante. Phasellus eu ligula. Vestibulum sit amet
            purus. Vivamus hendrerit, dolor at aliquet laoreet, mauris turpis porttitor
            velit, faucibus interdum tellus libero ac justo. Vivamus non quam. In
            suscipit faucibus urna.
        %h3
          %a{ href: "#" }
            Section 3
        %div
          %p
            Nam enim risus, molestie et, porta ac, aliquam ac, risus. Quisque lobortis.
            Phasellus pellentesque purus in massa. Aenean in pede. Phasellus ac libero
            ac tellus pellentesque semper. Sed ac felis. Sed commodo, magna quis
            lacinia ornare, quam ante aliquam nisi, eu iaculis leo purus venenatis dui.
          %ul
            %li
              List item one
            %li
              List item two
            %li
              List item three
        %h3
          %a{ href: "#" }
            Section 4
        %div
          %p
            Cras dictum. Pellentesque habitant morbi tristique senectus et netus
            et malesuada fames ac turpis egestas. Vestibulum ante ipsum primis in
            faucibus orci luctus et ultrices posuere cubilia Curae; Aenean lacinia
            mauris vel est.
          %p
            Suspendisse eu nisl. Nullam ut libero. Integer dignissim consequat lectus.
            Class aptent taciti sociosqu ad litora torquent per conubia nostra, per
            inceptos himenaeos.
    </script>
    </td></tr></table>
  </body>
</html>

